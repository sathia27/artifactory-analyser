name: Artifact analyser

on:
  push:
    branches:
      - master
jobs:
  test:
    runs-on: ubuntu-latest
    name: Running test
    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 11
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew
    - name: Execute test
      run: ./gradlew test
  build:
    runs-on: ubuntu-latest
    name: Build
    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 11
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew
    - name: Build with Gradle
      run: ./gradlew build
  publish:
    runs-on: ubuntu-latest
    name: Publishing to Repository
    needs: build
    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 11
    - name: Grant execute permission for jfrog
      run: chmod +x jfrog
    - name: Publishing
      run: |
        echo "testing"
        ./jfrog rt config --url http://$JROG_HOST/artifactory --user sathia --password $CI_JOB_PASSWORD
        /jfrog rt u build/libs/artifactory-analyser-1.0.jar artifact-analyser-test
        echo $JROG_HOST
      env:
        JROG_HOST: http://35.184.246.154
        CI_JOB_PASSWORD: ${{ secrets.CI_JOB_PASSWORD }}